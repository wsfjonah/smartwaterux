"use strict";var env={};window&&Object.assign(env,window.__env);var app=angular.module("xProject",["ngMaterial","pascalprecht.translate","ngRoute","ngCookies","LocalStorageModule","xProject.config","xProject.directive","xProject.factory","xProject.filter","xProject.services","xProject.auth"]);app.constant("__env",env),app.controller("layoutCtrl",function($scope,$translate,authService,$location,$rootScope,$window){var vm=this,flag_path=__env.folder+"/assets/img/flags/",default_userInfo={username:"",token:"",role:"",projects:[],current_project:{name:""},timezone:"",lang:"",apps:{}};vm.flag_img={en:flag_path+"US.png",cn:flag_path+"CN.png"},vm.lang_trans={en:"us",cn:"cn"},vm.currLang=vm.flag_img[$rootScope.lang],$scope.$on("$includeContentLoaded",function(){xpro.initPageLoadedLibrary()}),$scope.$on("$viewContentLoaded",function(){xpro.resizeHeader()}),vm.userInfo=authService.getAuthentication(),$scope.$watch(function(){return authService.getAuthentication()},function(){vm.userInfo=authService.getAuthentication()},!0),vm.layoutViewClass=function(){return angular.isDefined($rootScope.page_key)&&"login"===$rootScope.page_key?"layout-login":""},vm.isCurrentPath=function(path){return $location.path()==path},vm.changeLanguage=function(key){$translate.use(key),__env.langReloadPath.indexOf($location.$$path)>=0&&$window.location.reload()},vm.isAuthenticated=function(){return authService.isLoggedIn()},vm.switchProject=function(projectId){authService.switchProject(projectId).then(function(response){angular.isDefined(response.data.token)&&(authService.updateProject(response.data),function(){var opts=authService.getAuthentication();vm.userInfo=angular.extend({},default_userInfo,opts),console.log(vm.userInfo)}())})},vm.logout=function(){vm.userInfo=angular.extend({},vm.userInfo,default_userInfo),authService.logout(),$location.path("/login")},$rootScope.$on("$translateChangeSuccess",function(event,data){$rootScope.lang=data.language,vm.currLang=vm.lang_trans[data.language]})}),app.run(["$rootScope","$location","authService",function($rootScope,$location,authService){$rootScope.lang="en",$rootScope.page_key="",$rootScope.$on("$routeChangeStart",function(event,currRoute){if(angular.isDefined(currRoute.page_params)&&angular.isDefined(currRoute.page_params.key)&&($rootScope.page_key=currRoute.page_params.key),angular.isDefined(currRoute.restrictions)&&currRoute.restrictions.ensureAuthenticated){authService.isLoggedIn()||(authService.logout(),$location.path("/login"))}})}]),app.config(function($httpProvider,$translateProvider,$qProvider){$qProvider.errorOnUnhandledRejections(!1),$httpProvider.interceptors.push("authInterceptorService"),angular.isDefined($httpProvider.defaults.headers.get)||($httpProvider.defaults.headers.get={}),$httpProvider.defaults.headers.get["Cache-Control"]="no-cache",$httpProvider.defaults.headers.get.Pragma="no-cache",$translateProvider.useStaticFilesLoader({prefix:__env.localeFolderUrl,suffix:".json"}).preferredLanguage("en").useLocalStorage().useSanitizeValueStrategy("escapeParameters")}),app.factory("authInterceptorService",["$q","$injector","$location","localStorageService",function($q,$injector,$location,localStorageService){var authInterceptorServiceFactory={};return authInterceptorServiceFactory.request=function(config){config.headers=config.headers||{};var authData=localStorageService.get("authorizationData"),ignore_url=__env.ignoreInterceptorRequest;return null!==authData&&angular.isDefined(authData.token)&&ignore_url.indexOf(config.url)<0&&(config.params={token:authData.token}),config},authInterceptorServiceFactory.responseError=function(rejection){console.log("##rejection"),(401===rejection.status||-1===rejection.status&&"abort"!==rejection.xhrStatus)&&($injector.get("authService").logout(),$location.path("/login"));return $q.reject(rejection)},authInterceptorServiceFactory}]),function(){angular.module("xProject.config",["oc.lazyLoad"]).config(function($routeProvider){$routeProvider.when("/main",{templateUrl:__env.folder+"/app/modules/main/main.html",controller:"mainController as vm",restrictions:{ensureAuthenticated:!0,loginRedirect:!1},page_params:{key:"dashboard"},resolve:{loadMyCtrl:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({serie:!0,files:["assets/js/plugins/sparkline/jquery.sparkline.min.js","assets/js/plugins/chartist-js/dist/chartist.min.css","assets/js/plugins/chartist-plugin-tooltip-master/dist/chartist-plugin-tooltip.css","assets/js/plugins/chartist-js/dist/chartist.min.js","assets/js/plugins/chartist-plugin-tooltip-master/dist/chartist-plugin-tooltip.min.js","assets/js/xpro_dashboard.js","app/modules/main/mainCtrl.js"]})}]}}).when("/location",{templateUrl:__env.folder+"/app/modules/remote/location.html",controller:"locationController as vm",restrictions:{ensureAuthenticated:!0,loginRedirect:!1},page_params:{key:"location"},resolve:{loadMyCtrl:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({serie:!0,files:["app/vendors/angular-daterangepicker.min.js","app/modules/remote/locationCtrl.js","app/modules/remote/modalEventDetailsCtrl.js","app/modules/remote/modalTimeSeriesCtrl.js","app/modules/remote/modalHighRateCtrl.js","app/modules/remote/modalDetailsCtrl.js"]})}]}}).when("/site",{templateUrl:__env.folder+"/app/modules/remote/site.html",controller:"siteTableController as vm",restrictions:{ensureAuthenticated:!0,loginRedirect:!1},resolve:{loadMyCtrl:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({serie:!0,files:["assets/css/bootstrap-table.css","assets/js/bootstrap-table.min.js","app/vendors/bootstrap-table-angular.min.js","assets/js/locale/bootstrap-table-zh-CN.min.js","assets/js/locale/bootstrap-table-en-US.min.js","app/vendors/angular-daterangepicker.min.js","app/modules/remote/modalEventDetailsCtrl.js","app/modules/remote/modalTimeSeriesCtrl.js","app/modules/remote/modalHighRateCtrl.js","app/modules/remote/modalDetailsCtrl.js","app/modules/remote/modalMapCtrl.js","app/modules/remote/siteTableCtrl.js"]})}]},page_params:{key:"site"}}).when("/gis",{templateUrl:__env.folder+"/app/modules/network/gis.html",controller:"gisController as vm",restrictions:{ensureAuthenticated:!0,loginRedirect:!1},resolve:{loadMyCtrl:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({serie:!0,files:["app/modules/network/gisCtrl.js"]})}]},page_params:{key:"gis"}}).when("/network-analysis",{templateUrl:__env.folder+"/app/modules/network/networkAnalysis.html",controller:"networkAnalysisController as vm",restrictions:{ensureAuthenticated:!0,loginRedirect:!1},resolve:{loadMyCtrl:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({serie:!0,files:["app/modules/network/networkAnalysisCtrl.js"]})}]},page_params:{key:"networkAnalysis"}}).when("/network-data",{templateUrl:__env.folder+"/app/modules/network/networkData.html",controller:"networkDataController as vm",restrictions:{ensureAuthenticated:!0,loginRedirect:!1},resolve:{loadMyCtrl:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load(["app/modules/network/networkDataCtrl.js","app/vendors/angular-daterangepicker.min.js","app/modules/remote/modalEventDetailsCtrl.js","app/modules/remote/modalTimeSeriesCtrl.js","app/modules/remote/modalHighRateCtrl.js"])}]},page_params:{key:"network_data"}}).when("/monitoring",{templateUrl:__env.folder+"/app/modules/monitor/monitor.html",controller:"monitorController as vm",restrictions:{ensureAuthenticated:!0,loginRedirect:!1},resolve:{loadMyCtrl:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load(["app/vendors/fastRepeat.js","app/vendors/ng-infinite-scroll.min.js","app/modules/monitor/monitorCtrl.js"])}]},page_params:{key:"monitor"}}).when("/login",{templateUrl:__env.folder+"/app/modules/auth/login.html",controller:"authLoginController",controllerAs:"authLoginCtrl",restrictions:{ensureAuthenticated:!1,loginRedirect:!1},page_params:{key:"login"}}).otherwise({redirectTo:"/main"})})}(),function(){function authService($http,localStorageService,$httpParamSerializerJQLike){var _authentication_info={isAuth:!1,username:"",token:"",role:"",projects:[],current_project:{name:""},timezone:"",lang:"",apps:{}};this.login=function(user){return $http({method:"POST",url:__env.userLoginUrl,data:$httpParamSerializerJQLike(user),headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}})},this.switchProject=function(projectId){var params={projectid:projectId,token:this.getAuthentication().token};return $http({method:"POST",url:__env.switchProjectUrl,data:$httpParamSerializerJQLike(params),headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}})},this.updateProject=function(res){var opts_res=angular.extend({},this.getAuthentication(),res);angular.isDefined(res.token)&&""!==res.token&&(opts_res.isAuth=!0),localStorageService.set("authorizationData",opts_res)},this.setAuthentication=function(res){var opts_res=angular.extend({},_authentication_info,res);angular.isDefined(res.token)&&""!==res.token&&(opts_res.isAuth=!0),localStorageService.set("authorizationData",opts_res),this.getAuthentication()},this.isLoggedIn=function(){var user_info=this.getAuthentication(),isAuth=angular.isDefined(user_info.isAuth)&&user_info.isAuth,isToken=angular.isDefined(user_info.token)&&""!==user_info.token;return isAuth&&isToken},this.getAuthentication=function(){var auth_res=localStorageService.get("authorizationData");return null===auth_res&&(auth_res=_authentication_info),auth_res},this.logout=function(){localStorageService.set("authorizationData",_authentication_info),this.updateProject(_authentication_info)}}function apiService($http,localStorageService,$httpParamSerializerJQLike,authService){var apiBaseURL=__env.baseUrl,headers={Pragma:void 0,"Cache-Control":void 0,"X-Requested-With":void 0,"If-Modified-Since":void 0,"Content-Type":"application/json"};this.siteApi=function(string){var configArr={method:"GET",url:apiBaseURL+"site/search",headers:headers,data:$httpParamSerializerJQLike()};return void 0!==string&&""!==string&&(configArr.url=configArr.url+"?query="+string),$http(configArr)},this.timeSeriesAnyApi=function(id){return $http({method:"GET",url:__env.timeSeriesAnyUrl+"/"+id+"/any",headers:headers})},this.timeSeriesHighRateApi=function(res){return $http({method:"GET",url:__env.timeSeriesAnyUrl+"/"+res.id+"/highrate/"+res.from+"/"+res.to,headers:headers})},this.timeSeriesRangeApi=function(params){return $http({method:"GET",url:__env.timeSeriesRangeUrl+"/"+params.datapoints+"/"+params.resolution+"/"+params.from+"/"+params.to,headers:headers})},this.batchTimeSeriesApi=function(params){var defaultParams={datapoints:"",resolution:"1n",from:"1498875720000",to:"1515549960000",token:authService.getAuthentication().token},userParams=$.extend(!0,defaultParams,params);return $http({method:"POST",url:__env.batchTimeSeriesUrl,data:$httpParamSerializerJQLike(userParams),headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}})},this.eventAnyApi=function(){return $http({method:"GET",url:__env.eventAnyUrl,headers:headers})},this.eventAnyApiPaging=function(page){return $http({method:"GET",url:__env.eventAnyUrl+"/"+page,headers:headers})},this.eventDurationApi=function(res){return $http({method:"GET",url:__env.eventDurationUrl+"/"+res.to+"/"+res.duration,headers:headers})},this.eventMonitorApi=function(id,time){return $http({method:"GET",url:__env.eventDurationUrl+"/"+id+"/"+time,headers:headers})},this.eventRangeApi=function(from,to){return $http({method:"GET",url:__env.eventRangeUrl+"/"+from+"/"+to,headers:headers})},this.eventSingleRangeApi=function(datapointId,from,to){return $http({method:"GET",url:__env.eventSingleRangeUrl+"/"+datapointId+"/"+from+"/"+to,headers:headers})},this.eventDetailsApi=function(eventId){return $http({method:"GET",url:__env.eventDetailsUrl+"/"+eventId,headers:headers})},this.boundaryApi=function(){return $http({method:"GET",url:apiBaseURL+"map/boundary",headers:headers})},this.heatMapApi=function(){return $http({method:"GET",url:apiBaseURL+"map/heatmap",headers:headers})},this.sensorApi=function(query){return $http({method:"GET",url:apiBaseURL+"map/sensorjunction?query="+query,headers:headers})},this.pipeApi=function(query){return $http({method:"GET",url:apiBaseURL+"map/pipe?query="+query,headers:headers})},this.networkSensorApi=function(query){return $http({method:"GET",url:__env.networkSensorUrl,headers:headers})},this.networkPipeApi=function(query){return $http({method:"GET",url:__env.networkPipeUrl,headers:headers})},this.networkPipeSummaryApi=function(){return $http({method:"GET",url:__env.networkPipeSummaryUrl,headers:headers})},this.networkAnalysisPipeApi=function(query){return $http({method:"GET",url:__env.networkAnalysisPipeUrl,headers:headers})},this.networkAnalysisCoverageApi=function(id){return $http({method:"GET",url:__env.networkAnalysisSensorCoverageUrl+"?site="+id,headers:headers})},this.networkPumpApi=function(){return $http({method:"GET",url:__env.networkPumpUrl,headers:headers})},this.networkHydrantApi=function(mapcenter){return $http({method:"GET",url:__env.networkHydrantUrl+"?mapcenter="+mapcenter,headers:headers})},this.networkPipeDetailsApi=function(mapcenter){return $http({method:"GET",url:__env.networkPipeDetailsUrl+"?mapcenter="+mapcenter,headers:headers})}}angular.module("xProject.services",[]).service("authService",authService).service("commonService",function(){this.getColors=function(){return["#FF1493","#FFA500","#0f7ca8","#3867c4","#96137c","#b79494","#f9b49d","#c60303","#008066","#823f5e","#687759","#d14959","#703e7f","#000000"]},this.markerConfig=function(){return{icon:"assets/images/map/marker_n.png",width:30,height:38,title:"",content:""}}}).service("apiService",apiService),authService.$inject=["$http","localStorageService","$httpParamSerializerJQLike"],apiService.$inject=["$http","localStorageService","$httpParamSerializerJQLike","authService"]}(),function(){function canvasAction(elem,opts){$("#"+opts.chartElem).find(".canvasjs-chart-toolbar").addClass("hide"),opts.min<=0&&opts.max<=0?$(elem).hide():$(elem).show(),togglePan($(elem).find('[data-state="pan"]'),opts,!0)}function togglePan(btnElem,opts,isTrigger){var panElem=btnElem,toolbar=$("#"+opts.chartElem).find(".canvasjs-chart-toolbar"),value=panElem.data("value"),panActive=panElem.hasClass("isactive");if(void 0!==isTrigger&&isTrigger)return"pan"===value?toolbar.find('button[state="zoom"]').click():"zoom"===value&&toolbar.find('button[state="pan"]').click(),!1;panActive?(toolbar.find('button[state="zoom"]').click(),panElem.data("original-title","Pan Move").data("value","pan").removeClass("isactive").find("i").attr("class","ti-split-h")):(toolbar.find('button[state="pan"]').click(),panElem.data("original-title","Zoom").data("value","zoom").addClass("isactive").find("i").attr("class","ti-zoom-in")),xpro.destroyTooltip(),xpro.tooltips()}function elemReady($parse){return{restrict:"A",link:function($scope,elem,attrs){elem.ready(function(){$scope.$apply(function(){$parse(attrs.elemReady)($scope)})})}}}function projectDropdown(authService,$location){return{restrict:"E",scope:{options:"="},template:'<a href="JavaScript:void(0);" class="dropdown-item" ng-repeat="(key, val) in data.projects" ng-class="{active : data.current_project._id == key}" ng-click="switch(key)">{{ val }}</a>',controller:function($scope){$scope.data=$scope.options,$scope.switch=function(key){key!==$scope.data.current_project._id&&authService.switchProject(key).then(function(response){angular.isDefined(response.data.token)&&(authService.updateProject(response.data),$scope.data=response.data,$location.path(__env.pageMain))})}}}}function xproMap(modalService,mapApi,$translate){return{restrict:"AE",replace:"true",scope:{info:"@",options:"=",onMapLoaded:"&"},link:function(scope,elem){var topHt=$(".topbar").outerHeight();elem.css("height",$(window).height()-topHt),$(window).resize(function(){elem.css("height",$(window).height()-topHt)}),scope.initialize=function(){var opts=angular.extend({},{navCtrl:!0,scaleCtrl:!0,overviewCtrl:!0,enableScrollWheelZoom:!0,enableAutoResize:!0,zoom:10,mapType:"map",fullScreen:!1},scope.options),map=createMapInstance(opts,elem),previousMarkers=[];redrawMarkers(map,$translate,previousMarkers,opts,scope,modalService),boundaryArea(map,opts),scope.$watch("options.markers",function(){redrawMarkers(map,$translate,previousMarkers,opts,scope,modalService)},!0),scope.$watch("options.boundary",function(){boundaryArea(map,opts)},!0)},mapApi.then(function(){scope.initialize()},function(){})},template:'<div ng-style="divStyle"><label ng-style="labelStyle"></label></div>'}}function xproHeatmap($translate,mapApi){return{restrict:"AE",replace:"true",scope:{info:"@",options:"=",onMapLoaded:"&"},link:function(scope,elem){var topHt=$(".topbar").outerHeight();elem.css("height",$(window).height()-topHt),$(window).resize(function(){elem.css("height",$(window).height()-topHt)}),scope.initialize=function(){var opts=angular.extend({},{navCtrl:!0,scaleCtrl:!0,overviewCtrl:!0,enableScrollWheelZoom:!0,zoom:10,mapType:"heatmap",fullScreen:!1},scope.options),map=createMapInstance(opts,elem,$translate),previousMarkers=[];redrawMarkers(map,$translate,previousMarkers,opts,scope),scope.$watch("options.markers",function(){redrawMarkers(map,$translate,previousMarkers,opts,scope)},!0),scope.$watch("options.pipes",function(){drawPipeArea(map,opts)},!0),scope.$watch("options.heatMap",function(newValue){newValue.length&&map.addEventListener("tilesloaded",drawHeatMap(map,opts))},!0)},mapApi.then(function(){scope.initialize()},function(){})},template:'<div ng-style="divStyle"><label ng-style="labelStyle"></label></div>'}}function xproNetworkMap($translate,mapApi,apiService,dialogService,modalService,notify){return{restrict:"AE",replace:"true",scope:{info:"@",options:"=",onMapLoaded:"&"},link:function(scope,elem){var topHt=$(".topbar").outerHeight();elem.css("height",$(window).height()-topHt),$(window).resize(function(){elem.css("height",$(window).height()-topHt)}),scope.initialize=function(){var opts=angular.extend({},{navCtrl:!0,scaleCtrl:!0,overviewCtrl:!0,enableScrollWheelZoom:!0,zoom:10,mapType:"networkmap",fullScreen:!1},scope.options),map=createMapInstance(opts,elem,$translate),previousMarkers=[];scope.$watch("options.markers",function(){redrawMarkers(map,$translate,previousMarkers,opts,scope,null,apiService,dialogService)},!0),scope.$watch("options.menus",function(){!function(map,opts,$translate,apiService,dialogService){var menu=opts.menus,langMenu={search:$translate.instant("site_network_toolbar_search"),pipes:$translate.instant("site_network_toolbar_pipes"),sensors:$translate.instant("site_network_toolbar_sensors"),status:$translate.instant("site_network_toolbar_status"),pumps:$translate.instant("site_network_toolbar_pumps"),hydrant:$translate.instant("site_network_toolbar_hydrant"),pipeDetails:$translate.instant("site_network_toolbar_pipe_details"),coverage:$translate.instant("site_network_toolbar_coverage"),cart:$translate.instant("site_network_data_plot_plotlist")};$("#map_menu").length&&$("#map_menu").remove();toggleNetworkMapButtons.prototype=new T.Control,toggleNetworkMapButtons.prototype.initialize=function(map){var div=document.createElement("div");if(div.className="btn-group map-menu",div.setAttribute("id","map_menu"),div.setAttribute("role","group"),menu.hasOwnProperty("search")){var divSearch=document.createElement("div");divSearch.className="btn-group group-search";var searchToggle=document.createElement("button");searchToggle.className="btn-toggle btn-link";var searchIcon=document.createElement("i");searchIcon.className="ti-search";var searchDropdown=document.createElement("div");searchDropdown.className="dropdown-search";var searchClear=document.createElement("a");searchClear.className="remove";var clearIcon=document.createElement("i");clearIcon.className="ti-close";var searchInput=document.createElement("input");searchInput.setAttribute("type","text"),searchInput.setAttribute("placeholder","search"),searchClear.appendChild(clearIcon),searchToggle.appendChild(searchIcon),searchDropdown.appendChild(searchClear),searchDropdown.appendChild(searchInput),searchToggle.onclick=function(){var group=$(this).parents(".group-search"),isActive=group.hasClass("on-search"),isKeyword=group.hasClass("on-keyword"),input=group.find("input"),prevVal=void 0!==input.data("value")?input.data("value"):"";removeActiveClass(["cart","multi"]),isActive?group.removeClass("on-search"):(group.addClass("on-search"),isKeyword||input.val(""),input.val(prevVal).focus())},searchClear.onclick=function(e){e.preventDefault();var group=$(this).parents(".group-search"),input=group.find("input");group.removeClass("on-search").removeClass("on-keyword"),input.data("value",""),searchSensor(map,opts,"",dialogService,$translate)},searchInput.onkeyup=function(e){var elem=$(this),group=elem.parents(".group-search"),value=$.trim(elem.val()),prevVal=void 0!==elem.data("value")?elem.data("value"):"";13===e.keyCode&&""!==value&&value!==prevVal&&(group.addClass("on-keyword"),elem.data("value",value),searchSensor(map,opts,value,dialogService,$translate))},searchInput.onblur=function(){var group=$(this).parents(".group-search");setTimeout(function(){group.removeClass("on-search")},500)},divSearch.appendChild(searchToggle),divSearch.appendChild(searchDropdown),div.appendChild(divSearch)}if(menu.hasOwnProperty("cart")){var divCartGroup=document.createElement("div");divCartGroup.className="btn-group cart-group";var cartMenuButton=document.createElement("button");cartMenuButton.className="btn btn-secondary btn-outline btn-sm",cartMenuButton.setAttribute("type","button"),cartMenuButton.innerHTML=langMenu.cart;var badgeDiv=document.createElement("span");badgeDiv.className="badge badge-primary m-l-5",badgeDiv.setAttribute("id","count_badge"),badgeDiv.innerHTML="0",cartMenuButton.appendChild(badgeDiv),divCartGroup.appendChild(cartMenuButton),cartMenuButton.onclick=function(e){var elem=$(e.target),pr=elem.parents(".cart-group"),isActive=elem.hasClass("active");removeActiveClass(["search","multi"]),isActive?(elem.removeClass("active"),pr.removeClass("active")):(elem.addClass("active"),pr.addClass("active"))};var cartDiv=document.createElement("div");cartDiv.className="cart-list card scale-up";var cartHeader=document.createElement("div");cartHeader.className="card-header";var cartHeaderTitle=document.createElement("h4");cartHeaderTitle.className="m-b-0",cartHeaderTitle.innerHTML=$translate.instant("site_network_data_plot_plotlist");var cartBody=document.createElement("div");cartBody.className="card-body",cartBody.setAttribute("id","cart_options_list"),cartHeader.appendChild(cartHeaderTitle),cartDiv.appendChild(cartHeader),cartDiv.appendChild(cartBody),divCartGroup.appendChild(cartDiv),div.appendChild(divCartGroup)}var divGroup=document.createElement("div");divGroup.className="btn-group multi-group";var divButtonTrigger=document.createElement("div");divButtonTrigger.className="btn btn-secondary btn-outline btn-sm btn-trigger";var divButtonTriggerIcon=document.createElement("i");divButtonTriggerIcon.className="ti-menu";var divSubGroup=document.createElement("div");return divSubGroup.className="sub-group",divButtonTrigger.appendChild(divButtonTriggerIcon),divGroup.appendChild(divButtonTrigger),divButtonTrigger.onclick=function(){var group=$(this).parents(".multi-group"),isActive=group.hasClass("active");removeActiveClass(["cart","search"]),isActive?group.removeClass("active"):group.addClass("active")},angular.forEach(menu,function(value,key){var divMenuGroup=document.createElement("button"),menuButton=document.createElement("button"),divDropdown=document.createElement("div");if("coverage"!==key&&"hydrant"!==key&&"cart"!==key&&"pipeDetails"!==key&&"search"!==key){(divMenuGroup=document.createElement("div")).className="btn-group",divMenuGroup.setAttribute("role","group"),(menuButton=document.createElement("button")).className="btn btn-secondary btn-outline btn-sm",menuButton.setAttribute("type","button"),menuButton.setAttribute("data-toggle","dropdown"),menuButton.innerHTML=langMenu[key],(divDropdown=document.createElement("div")).className="dropdown-menu",divMenuGroup.appendChild(menuButton);var divAll=document.createElement("a");divAll.setAttribute("class","dropdown-item active"),divAll.setAttribute("href","#"),divAll.setAttribute("data-value","all"),divAll.setAttribute("data-type",key),divAll.innerHTML=$translate.instant("site_network_toolbar_menu_all")+" "+langMenu[key],divDropdown.appendChild(divAll),divAll.onclick=function(e){e.preventDefault(),e.stopPropagation();var thisElem=$(e.target),type=thisElem.data("type"),isActive=!thisElem.hasClass("active");thisElem.toggleClass("active"),isActive?thisElem.siblings().addClass("active"):thisElem.siblings().removeClass("active"),toggleUpdateOverlay(type,map,isActive,"all",opts)},angular.forEach(value.results,function(row){var valName=row,divSub=document.createElement("a");divSub.setAttribute("class","dropdown-item active"),divSub.setAttribute("href","#"),divSub.setAttribute("data-value",valName),divSub.setAttribute("data-type",key),divSub.innerHTML=valName,divSub.onclick=function(e){e.preventDefault(),e.stopPropagation();var thisElem=$(e.target);thisElem.toggleClass("active");var items=thisElem.parent(".dropdown-menu").find(".dropdown-item"),itemNonSelect=items.filter(":not(.active):not([data-value='all'])"),itemAll=items.filter('[data-value="all"]'),value=thisElem.data("value"),type=thisElem.data("type"),isActive=thisElem.hasClass("active");itemNonSelect.length<=0?itemAll.addClass("active"):itemNonSelect.length<=parseInt(items.length-1)&&itemAll.removeClass("active"),toggleUpdateOverlay(type,map,isActive,value,opts)},divDropdown.appendChild(divSub)}),divMenuGroup.appendChild(divDropdown),divSubGroup.appendChild(divMenuGroup)}else if("coverage"===key)divMenuGroup.className="btn btn-secondary btn-outline btn-sm",divMenuGroup.innerHTML=langMenu[key],divMenuGroup.onclick=function(){!function(map,opts){angular.forEach(opts.coveragePipes,function(row){map.removeOverLay(row)}),opts.coveragePipes.length=0}(map,opts)},divSubGroup.appendChild(divMenuGroup);else if("hydrant"===key||"pipeDetails"===key){(divMenuGroup=document.createElement("div")).className="btn-group",divMenuGroup.setAttribute("role","group"),(menuButton=document.createElement("button")).className="btn btn-secondary btn-outline btn-sm",menuButton.setAttribute("type","button"),menuButton.setAttribute("data-toggle","dropdown"),menuButton.innerHTML=langMenu[key],(divDropdown=document.createElement("div")).className="dropdown-menu",divMenuGroup.appendChild(menuButton);var divSearch=document.createElement("a");divSearch.setAttribute("class","dropdown-item"),divSearch.setAttribute("href","#"),divSearch.setAttribute("data-value","all"),divSearch.setAttribute("data-type",key),divSearch.innerHTML=$translate.instant("site_network_toolbar_menu_search"),divDropdown.appendChild(divSearch),divSearch.onclick=function(e){e.preventDefault(),"hydrant"===key?function(map,opts,apiService,dialogService,$translate){var mapcenter=map.getCenter();map.getZoom()<13&&(map.setZoom(13),mapcenter=map.getCenter());apiService.networkHydrantApi(mapcenter.lat+","+mapcenter.lng).then(function(response){opts.hydrant.length=0,response.data.length?angular.forEach(response.data,function(row){var p=row.location[0],location={longitude:p.longitude,latitude:p.latitude};opts.hydrant.push(location)}):dialogService.alert(null,{title:$translate.instant("site_network_toolbar_hydrant"),content:$translate.instant("site_network_hydrant_no_found"),ok:$translate.instant("site_login_error_noted")}),function(map,opts){var centerPoints=[];opts.hasOwnProperty("hydrantInstance")&&opts.hydrantInstance.length;opts.hasOwnProperty("hydrantInstance")||(opts.hydrantInstance=[]);opts.hydrant.forEach(function(row){var markerItem=createMarker({icon:"assets/images/map/marker_hydrant.png",width:15,height:15,title:"",content:""},new T.LngLat(row.longitude,row.latitude));centerPoints.push({lng:row.longitude,lat:row.latitude}),opts.hydrantInstance.push(markerItem),map.addOverlay(markerItem),//markerItem.setLabel("")}),moveTargetToCenter(map,centerPoints)}(map,opts)})}(map,opts,apiService,dialogService,$translate):function(map,opts,apiService,dialogService,$translate){var mapcenter=map.getCenter();map.getZoom()<13&&(map.setZoom(13),mapcenter=map.getCenter());apiService.networkPipeDetailsApi(mapcenter.lat+","+mapcenter.lng).then(function(response){if(opts.pipeDetails.length=0,response.data.length){var results={};angular.forEach(response.data,function(row){var junctions=row.junctions,weight=parseInt(row.optional.diameter)/250;(results={}).weight=weight,results.location=[],angular.forEach(junctions,function(element){results.location.push({latitude:element.lat,longitude:element.lng})}),opts.pipeDetails.push(results)})}else dialogService.alert(null,{title:$translate.instant("site_network_toolbar_pipe_details"),content:$translate.instant("site_network_pipe_details_no_found"),ok:$translate.instant("site_login_error_noted")});!function(map,opts){var centerPoints=[];opts.hasOwnProperty("pipeDetailsInstance")&&opts.pipeDetailsInstance.length;opts.hasOwnProperty("pipeDetailsInstance")||(opts.pipeDetailsInstance=[]);opts.pipeDetails.forEach(function(row){var pipeArr=[];row.location.forEach(function(loc){var pt=new T.LngLat(loc.longitude,loc.latitude);pipeArr.push(pt),centerPoints.push({lng:loc.longitude,lat:loc.latitude})});var pipeOverlay=new T.Polyline(pipeArr,{strokeColor:"#000000",strokeWeight:row.weight,strokeOpacity:1});opts.pipeDetailsInstance.push(pipeOverlay),map.addOverlay(pipeOverlay)}),moveTargetToCenter(map,centerPoints)}(map,opts)})}(map,opts,apiService,dialogService,$translate)};var divClear=document.createElement("a");divClear.setAttribute("class","dropdown-item"),divClear.setAttribute("href","#"),divClear.setAttribute("data-value","clear"),divClear.setAttribute("data-type",key),divClear.innerHTML=$translate.instant("site_network_toolbar_menu_remove"),divDropdown.appendChild(divClear),divClear.onclick=function(e){e.preventDefault(),"hydrant"===key?function(map,opts){opts.hydrantInstance.length&&angular.forEach(opts.hydrantInstance,function(element){map.removeOverLay(element)});opts.hydrantInstance.length=0}(map,opts):function(map,opts){opts.pipeDetailsInstance.length&&angular.forEach(opts.pipeDetailsInstance,function(element){map.removeOverLay(element)});opts.pipeDetailsInstance.length=0}(map,opts)},divMenuGroup.appendChild(divDropdown),divSubGroup.appendChild(divMenuGroup)}}),divGroup.appendChild(divSubGroup),div.appendChild(divGroup),map.getContainer().appendChild(div),div};var myCtrl=new toggleNetworkMapButtons;map.addControl(myCtrl)}(map,opts,$translate,apiService,dialogService)},!0),angular.isDefined(opts.pipes)&&scope.$watch("options.pipes",function(){drawPipeArea(map,opts)},!0),angular.isDefined(opts.pumps)&&scope.$watch("options.pumps",function(){!function(map,opts){opts.pumpInstance=[],opts.pumps.forEach(function(row){var markerItem=createMarker({icon:"assets/images/map/marker_pump.png",width:38,height:46,title:"",content:""},new T.LngLat(row.longitude,row.latitude));markerItem.setTop(!0),opts.pumpInstance.push(markerItem),map.addOverlay(markerItem),//markerItem.setLabel("")})}(map,opts)},!0),angular.isDefined(opts.plotMarkers)&&scope.$watch("options.plotMarkers",function(){!function(map,opts,scope,$translate,modalService){var container=$("#cart_options_list"),lenMarker=opts.plotMarkers.length,html="";if(lenMarker){html+="<ul class='list-group'>";for(var i=0,len=lenMarker;i<len;i++)html+="<li class='list-group-item'>"+opts.plotMarkers[i].name+"<a class='remove-cart' data-toggle='remove_cart' data-id='"+opts.plotMarkers[i].datapoint.pressure._id+"' href='JavaScript:void(0);'><i class='ti-close'></i></a></li>";html+="</ul>",html+="<div class='footer-action'>",html+="<div class='btn-group'>",html+="<button type='button' class='btn btn-secondary' data-toggle='empty_cart'><i class='ti-trash'></i></button>",html+="<button type='button' class='btn btn-primary' data-toggle='modal_plot'><i class='ti-stats-up'></i></button>",html+="</div>",html+="</div>"}else html+="<h3 class='text-center m-t-20 text-muted'>"+$translate.instant("site_network_data_plot_no_sensor_found")+"</h3>";container.html(html);document.getElementById("count_badge").innerHTML=lenMarker,container.off().on("click",'[data-toggle="remove_cart"]',function(){removePlotMarker(map,opts,scope,$(this).data("id"))}).on("click",'[data-toggle="empty_cart"]',function(){removePlotMarker(map,opts,scope)}).on("click",'[data-toggle="modal_plot"]',function(){modalService.open(opts.modalUrl,opts.modalCtrl,opts.plotMarkers)})}(map,opts,scope,$translate,modalService)},!0)},mapApi.then(function(){scope.initialize()},function(){})},template:'<div ng-style="divStyle"><label ng-style="labelStyle"></label></div>'}}function mapApi($window,$q){var deferred=$q.defer();return $window.initMap=function(){deferred.resolve()},function(){var script=document.createElement("script");script.src="https://api.map.baidu.com/api?v=2.0&ak=CSFSaXio89D3WK1AB38sLNtnkV9fWZO4&callback=initMap",document.body.appendChild(script)}(),deferred.promise}function heatmapApi($window,$q){var deferred=$q.defer();return $window.initMap=function(){deferred.resolve()},function(){var script=document.createElement("script");script.src="",document.body.appendChild(script)}(),deferred.promise}function fullscreenControl(){this.defaultAnchor=T_ANCHOR_TOP_RIGHT,this.defaultOffset=new T.Size(10,10)}function toggleHeatMapButtons(){this.defaultAnchor=T_ANCHOR_TOP_RIGHT,this.defaultOffset=new T.Size(50,10)}function toggleNetworkMapButtons(){this.defaultAnchor=T_ANCHOR_TOP_RIGHT,this.defaultOffset=new T.Size(10,10)}function removePlotMarker(map,opts,$scope,id){angular.isDefined(id)?angular.forEach(opts.plotMarkers,function(value,index){value.datapoint.pressure._id===id&&(opts.plotMarkerInstance[index].setAnimation(null),$scope.$apply(function(){opts.plotMarkerInstance.splice(index,1),$scope.options.plotMarkers.splice(index,1)}))}):(angular.forEach(opts.plotMarkerInstance,function(value){value.setAnimation(null)}),$scope.$apply(function(){opts.plotMarkerInstance.length=0,$scope.options.plotMarkers.length=0}))}function createMapInstance(opts,element,$translate){var map=new T.Map(element[0]);return map.centerAndZoom(new T.LngLat(opts.center.longitude,opts.center.latitude),opts.zoom),map.addControl(new T.NavigationControl),map.setCurrentCity(opts.city),map.disableScrollWheelZoom(!0),function(map,opts,element){if(opts.fullScreen){(fullscreenControl.prototype=new T.Control).initialize=function(map){var zoomBtn=document.createElement("div");zoomBtn.className="btn waves-effect waves-light btn-secondary btn-sm";var zoomIcon=document.createElement("i");return zoomIcon.className="ti-fullscreen",zoomBtn.appendChild(zoomIcon),zoomBtn.onclick=function(){$(element).hasClass("map-fullscreen")?($(element).removeClass("map-fullscreen"),zoomIcon.className="ti-fullscreen"):($(element).addClass("map-fullscreen"),zoomIcon.className="ti-back-left")},map.getContainer().appendChild(zoomBtn),zoomBtn};var myZoomCtrl=new fullscreenControl;map.addControl(myZoomCtrl)}}(map,opts,element),function(map,opts,element,$translate){if("heatmap"===opts.mapType){(toggleHeatMapButtons.prototype=new T.Control).initialize=function(map){var div=document.createElement("div");div.className="btn-group",div.setAttribute("data-toggle","buttons");var labelHeatMap=document.createElement("label");labelHeatMap.className="btn btn-secondary btn-outline btn-sm active",labelHeatMap.setAttribute("for","toggle_heatmap");var chkHeatMap=document.createElement("input");chkHeatMap.type="checkbox",chkHeatMap.setAttribute("name","toggle_heatmap"),chkHeatMap.setAttribute("id","toggle_heatmap"),chkHeatMap.setAttribute("checked","checked"),labelHeatMap.append(chkHeatMap),labelHeatMap.innerHTML+=$translate.instant("site_city_heatmap_toolbar_heatmap");var labelPipe=document.createElement("label");labelPipe.className="btn btn-secondary btn-outline btn-sm active",labelPipe.setAttribute("for","toggle_pipe");var chkPipe=document.createElement("input");chkPipe.type="checkbox",chkPipe.setAttribute("name","toggle_pipe"),chkPipe.setAttribute("id","toggle_pipe"),chkPipe.setAttribute("checked","checked"),labelPipe.append(chkPipe),labelPipe.innerHTML+=$translate.instant("site_city_heatmap_toolbar_pipe");var labelMarker=document.createElement("label");labelMarker.className="btn btn-secondary btn-outline btn-sm active",labelMarker.setAttribute("for","toggle_marker");var chkMarker=document.createElement("input");return chkMarker.type="checkbox",chkMarker.setAttribute("name","toggle_marker"),chkMarker.setAttribute("id","toggle_marker"),chkMarker.setAttribute("checked","checked"),labelMarker.append(chkMarker),labelMarker.innerHTML+=$translate.instant("site_city_heatmap_toolbar_sensor"),div.appendChild(labelHeatMap),div.appendChild(labelPipe),div.appendChild(labelMarker),labelHeatMap.onchange=function(){var isOn=document.getElementById("toggle_heatmap").checked;void 0!==heatmapOverlay&&(isOn?heatmapOverlay.show():heatmapOverlay.hide())},labelPipe.onchange=function(){for(var isOn=document.getElementById("toggle_pipe").checked,allOverlay=map.getOverlays(),i=0;i<allOverlay.length-1;i++)"[object Polyline]"===allOverlay[i].toString()&&(isOn?allOverlay[i].show():allOverlay[i].hide())},labelMarker.onchange=function(){for(var isOn=document.getElementById("toggle_marker").checked,allOverlay=map.getOverlays(),i=0;i<allOverlay.length-1;i++)"[object Marker]"===allOverlay[i].toString()&&(isOn?allOverlay[i].show():allOverlay[i].hide())},map.getContainer().appendChild(div),div};var myCtrl=new toggleHeatMapButtons;map.addControl(myCtrl)}}(map,opts,0,$translate),map}function createMarker(marker,point){var newMarker=new T.Marker(point);if(marker.icon){var icon=new T.Icon(marker.icon,new T.Size(marker.width,marker.height),{anchor:new T.Size(15,marker.height)});newMarker=new T.Marker(point,{icon:icon})}return newMarker}function removeActiveClass(arr){var menu=$("#map_menu"),list={cart:".cart-group",search:".group-search",multi:".multi-group"};angular.forEach(arr,function(value){var opt=list[value];"search"===value||"multi"===value?menu.find(opt).length&&menu.find(opt).removeClass("active"):"cart"===value&&menu.find(opt).length&&menu.find(opt).removeClass("active").find(">button").removeClass("active")})}function searchSensor(map,opts,keyword,dialogService,$translate){var userValue=keyword,fields=["device_ref","name","geo_address"],matchArr=[],cloneInstance=opts.markerInstance,centerpoint=[];opts.onSearch=!0,angular.forEach(opts.markers,function(element,index){for(var key in element)if(-1!==$.inArray(key,fields)&&element[key].toLowerCase().indexOf(userValue.toLowerCase())>-1){var res=element;res.position=index,matchArr.push(res),centerpoint.push({lat:res.geo_latlng.split(",")[0],lng:res.geo_latlng.split(",")[1]});break}}),angular.forEach(cloneInstance,function(element){element.hide()}),angular.forEach(matchArr,function(element){cloneInstance[element.position].show()}),matchArr.length&&moveTargetToCenter(map,centerpoint),dialogService.alert(null,{title:$translate.instant("site_network_search_result_title"),content:$translate.instant("site_network_search_result_content",{num:matchArr.length}),ok:$translate.instant("site_login_error_noted"),clickOutsideToClose:!1,callback:function(){opts.onSearch=!1}})}function moveTargetToCenter(map,res){var points=[];res.forEach(function(loc){points.push(new T.LngLat(loc.lng,loc.lat))}),map.setViewport(points)}function toggleUpdateOverlay(type,map,status,value,opts){"sensors"===type?function(map,status,value,opts){var markerInstance=opts.markerInstance;status||"all"!==value?status&&"all"===value?angular.forEach(opts.markers,function(element,i){map.addOverlay(markerInstance[i])}):"all"!==value&&angular.forEach(opts.markers,function(element,i){element.tag.subzone===value&&(status?map.addOverlay(markerInstance[i]):map.removeOverLay(markerInstance[i]))}):angular.forEach(opts.markers,function(element,i){map.removeOverLay(markerInstance[i])})}(map,status,value,opts):"pipes"===type?function(map,status,value,opts){var pipeInstance=opts.pipeInstance;status||"all"!==value?status&&"all"===value?angular.forEach(opts.pipes,function(element,i){map.addOverlay(pipeInstance[i])}):"all"!==value&&angular.forEach(opts.pipes,function(element,i){element.subzone===value&&(status?map.addOverlay(pipeInstance[i]):map.removeOverLay(pipeInstance[i]))}):angular.forEach(opts.pipes,function(element,i){map.removeOverLay(pipeInstance[i])})}(map,status,value,opts):"status"===type?function(map,status,value,opts){var markerInstance=opts.markerInstance;status||"all"!==value?status&&"all"===value?angular.forEach(opts.markers,function(element,i){map.addOverlay(markerInstance[i])}):"all"!==value&&angular.forEach(opts.markers,function(element,i){element.status===value&&(status?map.addOverlay(markerInstance[i]):map.removeOverLay(markerInstance[i]))}):angular.forEach(opts.markers,function(element,i){map.removeOverLay(markerInstance[i])})}(map,status,value,opts):"pumps"===type&&function(map,status,value,opts){var pumpInstance=opts.pumpInstance;status||"all"!==value?status&&"all"===value?angular.forEach(opts.pumps,function(element,i){map.addOverlay(pumpInstance[i])}):"all"!==value&&angular.forEach(opts.pumps,function(element,i){element.name===value.toString()&&(status?map.addOverlay(pumpInstance[i]):map.removeOverLay(pumpInstance[i]))}):angular.forEach(opts.pumps,function(element,i){map.removeOverLay(pumpInstance[i])})}(map,status,value,opts)}function drawPipeArea(map,opts){opts.pipeInstance=[],opts.pipes.forEach(function(row){var pipeArr=[];row.location.forEach(function(loc){var pt=new T.LngLat(loc.longitude,loc.latitude);pipeArr.push(pt)});var pipeOverlay=new T.Polyline(pipeArr,{strokeColor:row.color,strokeWeight:row.weight,strokeOpacity:1});if(opts.pipeInstance.push(pipeOverlay),map.addOverlay(pipeOverlay),(row.title||row.content)&&"networkmapData"!==opts.mapType){var msg="<p>"+(row.title||"")+"</p><p>"+(row.content||"")+"</p>",infoWindowItem=new T.InfoWindow(msg,{enableMessage:!0,width:350});pipeOverlay.addEventListener("click",function(e){map.openInfoWindow(infoWindowItem,new T.LngLat(e.point.lng,e.point.lat))})}})}function boundaryArea(map,opts){var points=[],num=Math.ceil(opts.boundary.length/2);opts.boundary.forEach(function(loc){points.push(new T.LngLat(loc.longitude,loc.latitude))});var polygon=new T.Polygon(points,{strokeColor:"blue",strokeWeight:3,strokeOpacity:1,fillColor:""});opts.boundary.length&&map.centerAndZoom(new T.LngLat(opts.boundary[num].longitude,opts.boundary[num].latitude),opts.zoom),map.addOverlay(polygon),map.setViewport(points),function(map,opts){var points=[];opts.boundary.forEach(function(loc){points.push(new T.LngLat(loc.longitude,loc.latitude))}),map.setViewport(points)}(map,opts)}function drawHeatMap(map,opts){if(!function(){var elem=document.createElement("canvas");return!(!elem.getContext||!elem.getContext("2d"))}()||void 0===map)return!1;map.removeEventListener("tilesloaded",drawHeatMap);heatmapOverlay=new TLib.HeatmapOverlay({radius:150}),map.addOverlay(heatmapOverlay),heatmapOverlay.setDataSet({data:opts.heatMap,max:90}),heatmapOverlay.show()}function redrawMarkers(map,$translate,previousMarkers,opts,$scope,modalService,apiService,dialogService){var points=[];opts.hasOwnProperty("onSearch")&&opts.onSearch||(previousMarkers.forEach(function(item){var marker=item.marker,listener=item.listener;marker.removeEventListener("click",listener),map.removeOverLay(marker)}),previousMarkers.length=0,opts.markers&&(opts.hasOwnProperty("markerInstance")?opts.markerInstance.length=0:opts.markerInstance=[],opts.markers.forEach(function(marker){var markerItem=createMarker(marker,new T.LngLat(marker.longitude,marker.latitude)),infoButton="<div class='btn-group'>";infoButton+="<button type='button' class='btn btn-secondary' data-toggle='tooltip' data-trigger='hover' title='"+$translate.instant("site_location_button_viewinfo")+"' id='baidu_marker_info'><i class='ti-info-alt'></i></button>",infoButton+="<button type='button' class='btn btn-secondary' data-toggle='tooltip' data-trigger='hover' title='"+$translate.instant("site_location_button_viewdata")+"' id='baidu_marker_data'><i class='ti-stats-up'></i></button>",infoButton+="</div>",points.push(new T.LngLat(marker.longitude,marker.latitude)),opts.markerInstance.push(markerItem),map.addOverlay(markerItem),//markerItem.setLabel("");var previousMarker={marker:markerItem,listener:null};if(previousMarkers.push(previousMarker),marker.title||marker.content){var msg="<p>"+(marker.title||"")+"</p><p>"+(marker.content||"")+"</p>";if("map"===opts.mapType)msg+=infoButton;else if("networkAnalysisMap"===opts.mapType){var coverageButton="<button type='button' class='btn btn-secondary' data-toggle='tooltip' data-trigger='hover' title='"+$translate.instant("site_network_map_button_coverage")+"' id='network_coverage_info'><i class='ti-target'></i></button>";msg="<p>"+(marker.title||"")+"</p>"+coverageButton+"<p>"+(marker.content||"")+"</p>"}else if("networkmapData"===opts.mapType){var cartButton="<button type='button' class='btn btn-secondary' data-trigger='hover' id='network_data_addtocart'><i class='ti-plus'></i> "+$translate.instant("site_network_data_plot_addtoplot")+"</button>";msg="<p>"+(marker.title||"")+"</p>"+cartButton+"<p>"+(marker.content||"")+"</p>"}var infoWindowItem=new T.InfoWindow(msg,{enableMessage:!!marker.enableMessage});previousMarker.listener=function(){this.openInfoWindow(infoWindowItem);var elData=document.getElementById("baidu_marker_data"),elInfo=document.getElementById("baidu_marker_info"),elCoverage=document.getElementById("network_coverage_info"),elCart=document.getElementById("network_data_addtocart");angular.isDefined(modalService)&&null!==modalService&&(elData.addEventListener("click",function(){modalService.open(opts.modalUrl,opts.modalCtrl,marker)}),elInfo.addEventListener("click",function(){modalService.open(opts.modalUrlInfo,opts.modalCtrlInfo,marker)})),void 0!==elCoverage&&null!==elCoverage&&elCoverage.addEventListener("click",function(){apiService.networkAnalysisCoverageApi(marker._id).then(function(response){!function(map,opts,status,marker,results){var centerPoints=[];angular.forEach(results,function(row){var junctions=[];angular.forEach(row.junctions,function(element){var p=new T.LngLat(element.lng,element.lat);centerPoints.push({lng:element.lng,lat:element.lat}),junctions.push(p)});var pline=new T.Polyline(junctions,{strokeColor:"red",strokeWeight:7,strokeOpacity:.7});opts.coveragePipes.push(pline),map.addOverlay(pline)}),map.closeInfoWindow(),moveTargetToCenter(map,centerPoints)}(map,opts,0,0,response.data)})}),void 0!==elCart&&null!==elCart&&elCart.addEventListener("click",function(){var isUnique=function(oldArr,newArr){var isUnique=!0;return oldArr.length&&angular.forEach(oldArr,function(value){angular.isDefined(value.datapoint.pressure)&&value.datapoint.pressure._id===newArr.datapoint.pressure._id&&(isUnique=!1)}),isUnique}(opts.plotMarkers,marker),totalSelected=opts.plotMarkers.length;angular.isDefined(marker.datapoint.pressure)?(opts.hasOwnProperty("plotMarkerInstance")||(opts.plotMarkerInstance=[]),totalSelected<10?isUnique?(opts.plotMarkerInstance.push(markerItem),markerItem.setAnimation(T_ANIMATION_BOUNCE),$scope.$apply(function(){$scope.options.plotMarkers.push(marker)}),markerItem.hasOwnProperty("Ac")&&function(elem){var cart=$(".cart-group>button"),imgtodrag=elem.find("img");if(imgtodrag){var imgclone=imgtodrag.clone().offset({top:imgtodrag.offset().top,left:imgtodrag.offset().left}).css({opacity:"0.5",position:"absolute",height:"150px",width:"150px","z-index":"100"}).appendTo($("body")).animate({top:cart.offset().top+10,left:cart.offset().left+10,width:75,height:75},1e3);clearTimeout(cart_timer),cart.removeClass("bounce"),cart_timer=setTimeout(function(){cart.addClass("bounce"),setTimeout(function(){cart.removeClass("bounce")},2e3)},1500),imgclone.animate({width:0,height:0},function(){$(this).detach()})}}($(markerItem.Ac)),map.closeInfoWindow()):dialogService.alert(null,{title:$translate.instant("site_network_data_plot_title"),content:$translate.instant("site_network_data_plot_sensor_exists"),ok:$translate.instant("site_login_error_noted")}):dialogService.alert(null,{title:$translate.instant("site_network_data_plot_title"),content:$translate.instant("site_network_data_plot_warning_limit"),ok:$translate.instant("site_login_error_noted")})):dialogService.alert(null,{title:$translate.instant("site_network_data_plot_title"),content:$translate.instant("site_network_data_plot_sensor_error"),ok:$translate.instant("site_login_error_noted")})})},markerItem.addEventListener("click",previousMarker.listener),xpro.tooltips()}}),"heatmap"===opts.mapType&&map.setViewport(points)))}angular.module("xProject.directive",["ui.bootstrap"]).directive("xproMap",xproMap).directive("xproHeatmap",xproHeatmap).directive("xproNetworkMap",xproNetworkMap).directive("projectDropdown",projectDropdown).directive("canvasToolbar",function(){return{restrict:"AE",scope:{options:"="},template:'<div class="btn-group" role="group"><button type="button" class="btn btn-secondary" data-state="pan" data-value="pan" data-toggle="tooltip" title="Pan Move"><i class="ti-split-h"></i></button><button type="button" class="btn btn-secondary" data-state="reset" data-toggle="tooltip" title="Reset Zoom"><i class="ti-close"></i></button></div>',link:function(scope,elem){var default_opts={chartElem:null,min:0,max:0},opts=angular.extend({},default_opts,scope.options);canvasAction(elem,opts),elem.on("click",'button[data-state="pan"]',function(){togglePan($(this),opts)}),elem.on("click",'button[data-state="reset"]',function(){$("#"+opts.chartElem).find(".canvasjs-chart-toolbar").find('button[state="reset"]').click(),xpro.destroyTooltip()}),scope.$watch("options",function(newValue,oldValue){newValue!==oldValue&&(opts=angular.extend({},default_opts,newValue),canvasAction(elem,opts))},!0)}}}).directive("elemReady",elemReady).service("mapApi",mapApi).service("heatmapApi",heatmapApi);var heatmapOverlay;elemReady.$inject=["$parse"],projectDropdown.$inject=["authService","$location"],xproMap.$inject=["modalService","mapApi","$translate"],xproHeatmap.$inject=["$translate","mapApi"],xproNetworkMap.$inject=["$translate","mapApi","apiService","dialogService","modalService","notify"],mapApi.$inject=["$window","$q"],heatmapApi.$inject=["$window","$q"];var cart_timer=null}(),function(){angular.module("xProject.factory",[]).factory("dialogService",function($mdDialog){var dialogService={};return dialogService.alert=function(ev,opts){var opt_config=angular.extend({},{title:"Information",content:"Something went wrong! Please try again",ok:"Got It!",clickOutsideToClose:!0,callback:null},opts);$mdDialog.show($mdDialog.alert().parent(angular.element(document.querySelector("#popupContainer"))).clickOutsideToClose(opt_config.clickOutsideToClose).title(opt_config.title).textContent(opt_config.content).ariaLabel(opt_config.title).ok(opt_config.ok).targetEvent(ev)).then(function(){opt_config.callback()})},dialogService}).factory("notify",function($mdToast){var toastService={};return toastService.info=function(){$mdToast.show($mdToast.simple().textContent("Simple Toast!").position("top right").hideDelay(3e3))},toastService}).factory("modalService",function($uibModal){var modalInstance,vm=this;return{open:function(url,ctrl,data){(modalInstance=$uibModal.open({templateUrl:url,controller:ctrl,size:"lg",resolve:{items:function(){return data}}})).result.then(function(selectedItem){vm.selected=selectedItem},function(){})}}})}(),function(){angular.module("xProject.filter",[]).filter("isObjectEmpty",function(){return function(object){return angular.equals({},object)}}).filter("fromNow",function(){return function(timestamp){return moment(timestamp).fromNow()}}).filter("objLimitTo",function(){return function(obj,limit){var keys=Object.keys(obj);if(keys.length<1)return[];var ret=new Object,count=0;return angular.forEach(keys,function(key,arrayIndex){if(count>=limit)return!1;ret[key]=obj[key],count++}),ret}}).filter("resourceUrl",function($sce){var version=__env.assetVersion;return function(url){return $sce.trustAsResourceUrl(url+"?version="+version)}})}(),function(){function authLoginController($location,authService,dialogService,$translate){var vm=this;vm.user={},vm.onLogin=function(){authService.login(vm.user).then(function(user){angular.isDefined(user.data.token)?(authService.setAuthentication(user.data),$location.path(__env.pageMain)):dialogService.alert(null,{title:$translate.instant("site_login_error"),content:$translate.instant("site_login_info_invalid"),ok:$translate.instant("site_login_error_noted")})}).catch(function(){dialogService.alert(null,{title:$translate.instant("site_login_error"),content:$translate.instant("site_login_info_invalid"),ok:$translate.instant("site_login_error_noted")})})}}angular.module("xProject.auth",[]).controller("authLoginController",authLoginController),authLoginController.$inject=["$location","authService","dialogService","$translate"]}();
//# sourceMappingURL=angular-app.min.js.map
